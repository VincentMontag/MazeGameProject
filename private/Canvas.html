<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Maze Game</title>

<script src="Maze.js"></script>

    <style>
    	/*TODO*/
    	div{
    		margin: 1%;
    	}
    	
    	canvas{
    		border: 2px solid black;
    		margin: 0;
    		display:block;	
    		float: left;
 
    	}
    	
    	body {
    		background:lightyellow;
		}
		
    </style>
    	
</head>
<body>

	<h1>Welcome to our Web-Project: The Maze Game</h1>
	
	<div>
    	<canvas id = "MazeGame" width = "1520" height = "760"></canvas>
	</div>
	
</body>

<script>

let socket = null;
let port = null;

function openWebSocket() {
	console.log("Open websocket");
	// Create connection to server
	port = parseInt(location.port)+1;
	socket = new WebSocket(`ws://${location.hostname}:${port}`);
	socket.onopen = () => {
		// Some stuff executed on open
	};
	socket.onmessage = (event) => {
		let update = JSON.parse(event.data);
		
		console.log("Client "+update.id+" needs to get updated with the following data:");
		console.log(update.player.username+" "+update.player.car+" "+update.player.left+" "+
				update.player.top+" "+update.player.direction);
		
		// There could be a div tag or something else for each car to be drawn.
		// Such a div tag has to appear !ON! the canvas. That means canvas has z-index 0
		// and each div tag z-index 1.
		// Each div-tag has an id to identify the player. The player id is given by update.id
		// Then you can look if a tag with this id already exists by ...getElementByID(...)
		// If it exists update the positions (position of the div-tag) with data 
		// update.player.left and update.player.right
		// If it not exists create a new tag with the data. (ID, position and image)
		// Draw the image in the div tag (image index is stored in update.player.car 
		// (the same as Sophies slide indices))
		// The direction of the image can be detemrined by using update.player.direction
		
	};
	socket.onclose = () => {
		// Some stuff executed on close
	}
}
	
document.onkeydown = checkKey;
function checkKey(e){
	e = e ? e : window.event;		
	if(e.keyCode == '38'){
		move("UP");
	} else if(e.keyCode == '40'){
		move("DOWN");
	} else if(e.keyCode == '37'){
		move("LEFT");
	} else if(e.keyCode == '39'){
		move("RIGHT");
	}
}

function getCookie(name) {
	let cookie = {};
	document.cookie.split(';').forEach(function(el) {
		let [k,v] = el.split('=');
		cookie[k.trim()] = v;
	});
	return cookie[name];
}

function move(direction) {
	let action = {
		id: getCookie("session_id"),
		dir: direction
	};
	socket.send(JSON.stringify(action));
}

openWebSocket();

</script>

</html>
